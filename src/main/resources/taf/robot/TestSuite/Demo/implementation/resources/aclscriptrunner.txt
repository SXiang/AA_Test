*** Settings ***
Library           OperatingSystem
Library           AutoItLibrary    OutputDir=${outputdir}    CaptureScreenOnError=${True}
Library           Process

*** Keywords ***
ACLScriptRunner
    [Arguments]    ${Script_Owner}    ${ProjectName}    ${ScriptName}    ${Timeout}    @{MasterFiles}
    Set Test Variable    ${ProjectName}    ${testDir}\\Project\\${Encoding}\\${ProjectName}
    Set Test Variable    ${testDir}    ${ProjectName}\\..\\
    Set Test Variable    ${doneFile}    ${doneFile}.log
    Set Test Variable    ${status}    FAIL
    cleanup    ${sutDir}    ${imageName}    ${testDir}\\${doneFile}
    OperatingSystem.Run    Start "ACLScriptRunner" /D${testDir} /MAX /SEPARATE ${sutDir}\\${imageName} ${ProjectName} /x /vdoneFile="${doneFile}" /b${ScriptName}
    Wait Until Created    ${testDir}\\${doneFile}    ${Timeout}
    : FOR    ${file}    IN    ${doneFile},@{MasterFiles}
    \    ${status}=    File Should Exist    ${testDir}\\${file}
    \    Run Keyword And Ignore Error    ${status}=    File Should Exist    ${testDir}\\master\\${file}
    \    Run Keyword Unless    '${status}'=='PASS'    Copy File    ${testDir}\\${file}    ${testDir}\\master\\${file}
    \    ${masterdata｝=    Get File    ${testDir}\\master\\${file}
    \    ${actualdata}=    Get File    ${testDir}\\${file}
    \    ${status}=    Should Contain    ${actualdata}    ${masterdata｝
    [Teardown]    closeapp    ${status}    ${ScriptName}    ${ImageName}

cleanup
    [Arguments]    ${sutDir}    ${imageName}    ${doneFile}
    File Should Exist    ${sutDir}\\${imageName}
    Run Keyword And Ignore Error    Remove File    ${doneFile}

closeapp
    [Arguments]    ${status}    ${ScriptName}    ${ImageName}
    Run Keyword Unless    '${status}'=='PASS'    Get Screen Image    ${ImageName}_${ScriptName}.jpeg
    Run Keyword And Ignore Error    OperatingSystem.Run    taskkill /F /T /IM ${imageName}
